<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>NTX QUEST RADAR Â· Galxe ç©ºæŠ•é¡¹ç›®é›·è¾¾</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #050816;
      --bg-card: #050a12;
      --bg-card-soft: #08101c;
      --border-subtle: rgba(255, 255, 255, 0.03);
      --text-main: #f5f7ff;
      --text-sub: #9ca3af;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.12);
      --accent-strong: #0ea5e9;
      --danger: #f97373;
      --success: #22c55e;
      --warning: #facc15;
      --muted-pill: rgba(148, 163, 184, 0.18);
      --radius-lg: 18px;
      --radius-pill: 999px;
      --card-gap: 18px;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.65);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui,
        -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei",
        sans-serif;
      background: radial-gradient(circle at top left, #0f172a 0, #020617 40%, #000 90%);
      color: var(--text-main);
      min-height: 100vh;
      padding: 24px 28px 40px;
    }

    .app-shell {
      max-width: 1440px;
      margin: 0 auto;
    }

    /* é¡¶éƒ¨å¯¼èˆª */

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 18px;
      gap: 16px;
    }

    .brand {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .brand-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-logo {
      width: 26px;
      height: 26px;
      border-radius: 9px;
      background: radial-gradient(circle at 20% 20%, #e0f2fe, #0f172a);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 800;
      letter-spacing: 0.02em;
      color: #0b1220;
      box-shadow: 0 0 0 1px rgba(148, 163, 184, 0.35),
        0 10px 25px rgba(15, 23, 42, 0.75);
    }

    .brand-title {
      font-size: 20px;
      font-weight: 750;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    .brand-badge {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.35);
      color: var(--text-sub);
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .brand-badge span {
      color: var(--accent);
      font-weight: 500;
    }

    .brand-subtitle {
      font-size: 12px;
      color: var(--text-sub);
    }

    .brand-subtitle span {
      color: var(--accent-strong);
    }

    .top-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .pill-status {
      padding: 6px 12px;
      border-radius: var(--radius-pill);
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: radial-gradient(circle at 0 0, #111827, #020617 60%);
      color: var(--text-sub);
    }

    .pill-status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #ef4444;
      box-shadow: 0 0 0 5px rgba(248, 113, 113, 0.16);
    }

    .pill-status-dot.online {
      background: #22c55e;
      box-shadow: 0 0 0 5px rgba(34, 197, 94, 0.18);
    }

    .pill-status span {
      font-variant-numeric: tabular-nums;
    }

    /* æ§åˆ¶æ¡ */

    .controls {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
      margin-bottom: 18px;
    }

    .ctrl-group {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .ctrl-label {
      font-size: 12px;
      color: var(--text-sub);
    }

    .ctrl-pill {
      min-width: 80px;
      padding: 6px 10px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.9);
      font-size: 12px;
      color: var(--text-main);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .ctrl-pill-value {
      font-variant-numeric: tabular-nums;
      color: var(--accent);
    }

    .tabs {
      display: inline-flex;
      padding: 2px;
      border-radius: var(--radius-pill);
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.3);
      gap: 2px;
    }

    .tab {
      padding: 5px 12px;
      border-radius: var(--radius-pill);
      font-size: 12px;
      color: var(--text-sub);
      cursor: pointer;
      border: none;
      background: transparent;
      transition: all 0.16s ease-out;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .tab span.hot-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 0 4px rgba(56, 189, 248, 0.28);
    }

    .tab.active {
      background: radial-gradient(circle at 0 0, #0ea5e9, #0369a1);
      color: #e5f3ff;
      font-weight: 500;
      box-shadow: 0 10px 25px rgba(8, 47, 73, 0.7);
    }

    .tab:not(.active):hover {
      color: #e5f3ff;
      background: rgba(15, 23, 42, 0.9);
    }

    .search-wrapper {
      flex: 1;
      min-width: 220px;
      position: relative;
    }

    .search-input {
      width: 100%;
      padding: 7px 32px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148, 163, 184, 0.45);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-main);
      font-size: 13px;
      outline: none;
      transition: all 0.16s ease-out;
    }

    .search-input::placeholder {
      color: #6b7280;
    }

    .search-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.6);
      background: radial-gradient(circle at 0 0, #020617, #020617 40%, #000 100%);
    }

    .search-icon {
      position: absolute;
      left: 11px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 13px;
      color: #6b7280;
    }

    .btn-refresh {
      padding: 7px 14px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(56, 189, 248, 0.7);
      background: radial-gradient(circle at 0 0, #0ea5e9, #0369a1);
      color: #e0f2fe;
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(8, 47, 73, 0.85);
      white-space: nowrap;
    }

    .btn-refresh span.icon {
      font-size: 12px;
    }

    .btn-refresh.loading {
      opacity: 0.6;
      cursor: default;
    }

    /* ç½‘æ ¼ */

    .grid {
      margin-top: 10px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: var(--card-gap);
    }

    .card {
      border-radius: var(--radius-lg);
      background: radial-gradient(circle at 0 0, #0b1120, #020617);
      border: 1px solid rgba(148, 163, 184, 0.22);
      padding: 14px 14px 12px;
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      gap: 8px;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.12), transparent 55%);
      opacity: 0.7;
    }

    .card-inner {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .card-title-block {
      min-width: 0;
    }

    .card-title-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 2px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    .card-title-tag {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: var(--text-sub);
    }

    .card-sub {
      font-size: 11px;
      color: var(--text-sub);
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    .pill-latest {
      padding: 5px 10px;
      border-radius: var(--radius-pill);
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border: 1px solid rgba(34, 197, 94, 0.8);
      background: rgba(22, 163, 74, 0.15);
      color: #bbf7d0;
      white-space: nowrap;
    }

    .pill-latest span.dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.35);
    }

    .pill-latest.paused {
      border-color: rgba(250, 204, 21, 0.85);
      background: rgba(250, 204, 21, 0.16);
      color: #fef9c3;
    }

    .pill-latest.paused span.dot {
      background: #facc15;
      box-shadow: 0 0 0 4px rgba(250, 204, 21, 0.35);
    }

    .pill-latest.idle {
      border-color: rgba(148, 163, 184, 0.85);
      background: rgba(15, 23, 42, 0.85);
      color: #e5e7eb;
    }

    .pill-latest.idle span.dot {
      background: #94a3b8;
      box-shadow: 0 0 0 4px rgba(148, 163, 184, 0.35);
    }

    .activity-title {
      font-size: 12px;
      line-height: 1.45;
      margin-bottom: 4px;
      color: #e5e7eb;
    }

    .activity-title a {
      color: #bae6fd;
      text-decoration: none;
    }

    .activity-title a:hover {
      text-decoration: underline;
      color: #e0f2fe;
    }

    .meta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 11px;
      color: var(--text-sub);
    }

    .meta-item {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 7px;
      border-radius: var(--radius-pill);
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(31, 41, 55, 0.9);
    }

    .meta-item span.label {
      color: #6b7280;
    }

    .meta-item span.value {
      font-variant-numeric: tabular-nums;
    }

    .meta-item span.badge {
      font-size: 10px;
      padding: 1px 5px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: #e5e7eb;
    }

    .empty-hint {
      margin-top: 40px;
      text-align: center;
      color: var(--text-sub);
      font-size: 13px;
    }

    .empty-hint span {
      color: var(--accent);
    }

    @media (max-width: 768px) {
      body {
        padding: 16px 14px 28px;
      }
      .top-bar {
        flex-direction: column;
        align-items: flex-start;
      }
      .top-right {
        align-self: stretch;
        justify-content: space-between;
      }
      .controls {
        flex-direction: column;
        align-items: stretch;
      }
      .ctrl-group {
        width: 100%;
        justify-content: space-between;
      }
      .search-wrapper {
        width: 100%;
      }
      .grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header class="top-bar">
      <div class="brand">
        <div class="brand-row">
          <div class="brand-logo">N</div>
          <div class="brand-title">NTX QUEST RADAR</div>
          <div class="brand-badge">
            Galxe ç©ºæŠ•é¡¹ç›®é›·è¾¾ Â· <span>OpenAPI</span>
          </div>
        </div>
        <div class="brand-subtitle">
          Galxe ä»»åŠ¡ <span>é›†ä¸­ç›‘æ§é¢æ¿</span> Â· é€‚é…å¤š Space / é«˜å¹¶å‘è½®è¯¢
        </div>
      </div>
      <div class="top-right">
        <div class="pill-status" id="connectionPill">
          <span class="pill-status-dot" id="connDot"></span>
          <span id="connText">ç¦»çº¿ Â· ç­‰å¾…åŠ è½½</span>
        </div>
      </div>
    </header>

    <section class="controls">
      <div class="ctrl-group">
        <div class="ctrl-pill">
          <span class="ctrl-label">æœ€è¿‘åˆ·æ–°ï¼š</span>
          <span class="ctrl-pill-value" id="lastRefresh">â€”</span>
        </div>
        <div class="ctrl-pill">
          <span class="ctrl-label">é¡¹ç›®æ•°é‡ï¼š</span>
          <span class="ctrl-pill-value" id="projectCount">â€”</span>
        </div>
      </div>

      <div class="ctrl-group">
        <div class="tabs" id="viewTabs">
          <button class="tab active" data-mode="all">
            å…¨éƒ¨
          </button>
          <button class="tab" data-mode="custom">
            è‡ªå®šä¹‰
          </button>
          <button class="tab" data-mode="hot">
            <span class="hot-dot"></span>
            çƒ­åº¦ Top
          </button>
        </div>
      </div>

      <div class="search-wrapper">
        <span class="search-icon">ğŸ”</span>
        <input
          id="searchInput"
          class="search-input"
          placeholder="æœç´¢é¡¹ç›®å / alias / æ´»åŠ¨æ ‡é¢˜â€¦"
        />
      </div>

      <button class="btn-refresh" id="refreshBtn">
        <span class="icon">âŸ³</span>
        æ‰‹åŠ¨åˆ·æ–°
      </button>
    </section>

    <main id="cardsContainer">
      <div class="empty-hint">
        æç¤ºï¼šæ•°æ®æ¥è‡ªåç«¯æ¥å£ <span>/?raw=1&pwd=admin</span>ã€‚å¦‚éœ€æ”¹å¯†ç ï¼Œè¯·åŒæ­¥è°ƒæ•´
        config.json ä¸æœ¬é¡µè„šæœ¬ä¸­çš„ PWDã€‚
      </div>
    </main>
  </div>

  <script>
    const PWD = "admin"; // å’Œ config.json ä¸­ webui_password ä¿æŒä¸€è‡´
    const RAW_ENDPOINT = "/?raw=1";

    let rawData = null;
    let currentMode = "all";
    let searchKeyword = "";

    const els = {
      cardsContainer: document.getElementById("cardsContainer"),
      lastRefresh: document.getElementById("lastRefresh"),
      projectCount: document.getElementById("projectCount"),
      connDot: document.getElementById("connDot"),
      connText: document.getElementById("connText"),
      refreshBtn: document.getElementById("refreshBtn"),
      searchInput: document.getElementById("searchInput"),
      viewTabs: document.getElementById("viewTabs"),
    };

    function setOnline(online) {
      if (online) {
        els.connDot.classList.add("online");
        els.connText.textContent = "åœ¨çº¿ Â· å®æ—¶åŒæ­¥ä¸­";
      } else {
        els.connDot.classList.remove("online");
        els.connText.textContent = "ç¦»çº¿ Â· ç­‰å¾…åŠ è½½";
      }
    }

    function formatTime(ts) {
      if (!ts || ts === "-") return "-";
      // å¦‚æœå·²ç»æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œç›´æ¥è¿”å›
      if (typeof ts === "string" && ts.includes("-")) return ts;
      const n = Number(ts);
      if (!Number.isFinite(n) || n <= 0) return "-";
      // å…¼å®¹ç§’ / æ¯«ç§’
      const ms = n < 10_000_000_000 ? n * 1000 : n;
      const d = new Date(ms);
      if (Number.isNaN(d.getTime())) return "-";
      const pad = (x) => String(x).padStart(2, "0");
      return (
        d.getFullYear() +
        "-" +
        pad(d.getMonth() + 1) +
        "-" +
        pad(d.getDate()) +
        " " +
        pad(d.getHours()) +
        ":" +
        pad(d.getMinutes()) +
        ":" +
        pad(d.getSeconds())
      );
    }

    function computeStatus(latest) {
      const now = Date.now();
      const start = latest && latest.start_time ? Number(latest.start_time) : NaN;
      const end = latest && latest.end_time ? Number(latest.end_time) : NaN;

      if (!latest || (!latest.title && !latest.url)) {
        return { text: "æš‚æ— æ´»åŠ¨", style: "idle" };
      }

      if (Number.isFinite(start) && Number.isFinite(end)) {
        const msStart = start < 10_000_000_000 ? start * 1000 : start;
        const msEnd = end < 10_000_000_000 ? end * 1000 : end;
        if (now < msStart) {
          return { text: "æœªå¼€å§‹", style: "paused" };
        } else if (now > msEnd) {
          return { text: "å·²ç»“æŸ", style: "idle" };
        } else {
          return { text: "è¿›è¡Œä¸­", style: "active" };
        }
      }

      return { text: latest.status_text || "æœ‰æœ€æ–°æ´»åŠ¨", style: "active" };
    }

    function renderCards() {
      if (!rawData || !Array.isArray(rawData.projects)) {
        els.cardsContainer.innerHTML =
          '<div class="empty-hint">æš‚æ— æ•°æ®ï¼Œè¯·å°è¯•åˆ·æ–°æˆ–æ£€æŸ¥åç«¯é…ç½®ã€‚</div>';
        return;
      }

      let list = rawData.projects.slice();

      if (currentMode === "custom") {
        list = list.filter((p) => p.starred);
      } else if (currentMode === "hot") {
        list = list
          .filter((p) => p.trending || (p.tags || []).includes("hot"))
          .slice(0, 50);
      }

      if (searchKeyword.trim()) {
        const kw = searchKeyword.trim().toLowerCase();
        list = list.filter((p) => {
          const alias = (p.alias || "").toLowerCase();
          const name = (p.name || "").toLowerCase();
          const latest = p.latest || {};
          const title = (latest.title || "").toLowerCase();
          return (
            alias.includes(kw) ||
            name.includes(kw) ||
            title.includes(kw)
          );
        });
      }

      els.projectCount.textContent = list.length.toString();

      if (!list.length) {
        els.cardsContainer.innerHTML =
          '<div class="empty-hint">æ²¡æœ‰åŒ¹é…åˆ°é¡¹ç›®ï¼Œå¯ä»¥å°è¯•æ”¾å®½ç­›é€‰æ¡ä»¶æˆ–æ¸…ç©ºæœç´¢ã€‚</div>';
        return;
      }

      const chunks = [];
      for (const p of list) {
        const alias = p.alias || "-";
        const name = p.name || alias || "Unknown Space";
        const isTrending = !!(p.trending || (p.tags || []).includes("trending"));
        const latest = p.latest || {};
        const title =
          latest.title ||
          latest.name ||
          "å½“å‰æ²¡æœ‰å¯è§æ´»åŠ¨æˆ–æ‹‰å–å¤±è´¥ã€‚";
        const url = latest.url || latest.link || "#";
        const startText = latest.start_time_fmt || formatTime(latest.start_time);
        const endText = latest.end_time_fmt || formatTime(latest.end_time);
        const status = computeStatus(latest);

        let pillClass = "pill-latest";
        if (status.style === "paused") pillClass += " paused";
        else if (status.style === "idle") pillClass += " idle";

        const trendingTag = isTrending
          ? '<span class="card-title-tag">ğŸ”¥ Trending</span>'
          : "";

        const titleHtml =
          url && url !== "#"
            ? '<a href="' +
              url +
              '" target="_blank" rel="noreferrer">' +
              title.replace(/</g, "&lt;") +
              "</a>"
            : title.replace(/</g, "&lt;");

        const html =
          '<article class="card">' +
          '<div class="card-inner">' +
          '<header class="card-header">' +
          '<div class="card-title-block">' +
          '<div class="card-title-row">' +
          '<h2 class="card-title">' +
          name.replace(/</g, "&lt;") +
          "</h2>" +
          trendingTag +
          "</div>" +
          '<div class="card-sub">@' +
          alias.replace(/</g, "&lt;") +
          "</div>" +
          "</div>" +
          '<div class="' +
          pillClass +
          '">' +
          '<span class="dot"></span>' +
          "<span>" +
          status.text +
          "</span>" +
          "</div>" +
          "</header>" +
          '<div class="activity-title">' +
          titleHtml +
          "</div>" +
          '<div class="meta-row">' +
          '<div class="meta-item"><span class="label">å¼€å§‹æ—¶é—´</span><span class="value">' +
          startText +
          "</span></div>" +
          '<div class="meta-item"><span class="label">ç»“æŸæ—¶é—´</span><span class="value">' +
          endText +
          "</span></div>" +
          "</div>" +
          "</div>" +
          "</article>";

        chunks.push(html);
      }

      els.cardsContainer.innerHTML = '<section class="grid">' + chunks.join("") + "</section>";
    }

    async function loadData(opts = { showLoading: true }) {
      try {
        if (opts.showLoading) {
          els.refreshBtn.classList.add("loading");
        }
        setOnline(false);

        const url =
          RAW_ENDPOINT +
          "?raw=1&pwd=" +
          encodeURIComponent(PWD) +
          "&_t=" +
          Date.now();

        const resp = await fetch(url, { cache: "no-store" });
        if (!resp.ok) throw new Error("HTTP " + resp.status);
        const json = await resp.json();

        rawData = json || {};
        els.lastRefresh.textContent =
          rawData.last_cycle || rawData.lastRefresh || "åˆšåˆš";
        setOnline(true);
        renderCards();
      } catch (err) {
        console.error("åŠ è½½æ•°æ®å¤±è´¥:", err);
        setOnline(false);
        els.cardsContainer.innerHTML =
          '<div class="empty-hint">åŠ è½½å¤±è´¥ï¼š' +
          String(err.message || err) +
          "ã€‚è¯·ç¡®è®¤åç«¯ /?raw=1&pwd=admin èƒ½æ­£å¸¸è¿”å› JSONã€‚</div>";
      } finally {
        els.refreshBtn.classList.remove("loading");
      }
    }

    function initEvents() {
      els.refreshBtn.addEventListener("click", () => {
        loadData({ showLoading: true });
      });

      els.searchInput.addEventListener("input", (e) => {
        searchKeyword = e.target.value || "";
        renderCards();
      });

      els.viewTabs.addEventListener("click", (e) => {
        const btn = e.target.closest(".tab");
        if (!btn) return;
        const mode = btn.dataset.mode;
        if (!mode || mode === currentMode) return;
        currentMode = mode;
        Array.from(els.viewTabs.querySelectorAll(".tab")).forEach((el) =>
          el.classList.toggle("active", el.dataset.mode === currentMode)
        );
        renderCards();
      });
    }

    (function bootstrap() {
      initEvents();
      loadData({ showLoading: false });
      // å®šæ—¶è½®è¯¢
      setInterval(() => loadData({ showLoading: false }), 60 * 1000);
    })();
  </script>
</body>
</html>
