<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>NTX Quest Radar Â· V4.1</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    /* æ•´ä½“æš—è‰² + å¡ç‰‡å¸ƒå±€ï¼ˆä¿æŒä½ ç°åœ¨çš„é£æ ¼ï¼Œå¤§éƒ¨åˆ†æ²¿ç”¨åŸæœ‰æ ·å¼ï¼‰ */
    body {
      margin: 0;
      font-family: -apple-system,BlinkMacSystemFont,"SF Pro Text","Helvetica Neue",Arial,"PingFang SC","Microsoft YaHei",sans-serif;
      background: radial-gradient(circle at top,#131b2a 0,#050812 55%,#020308 100%);
      color: #e5efff;
    }
    .app-root {
      max-width: 1440px;
      margin: 0 auto;
      padding: 20px 24px 40px;
    }
    .app-header {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .app-title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    .app-title-left {
      display: flex;
      align-items: baseline;
      gap: 12px;
    }
    .logo-text {
      font-size: 22px;
      font-weight: 700;
      letter-spacing: .04em;
    }
    .logo-badge {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(126,202,255,.35);
      color: #7ecaff;
      background: linear-gradient(135deg,rgba(87,148,255,.15),rgba(74,222,222,.03));
    }
    .app-title-sub {
      font-size: 12px;
      color: #7c8aa5;
    }
    .stat-bar {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      font-size: 12px;
    }
    .stat-label-main {
      color: #9fb5ff;
    }
    .stat-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .stat-pill {
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(15,23,42,.9);
      border: 1px solid rgba(148,163,184,.3);
      color: #cbd5f5;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .stat-pill strong {
      color: #e5edff;
      font-weight: 600;
    }
    .stat-pill.green { border-color: rgba(45,212,191,.5); }
    .stat-pill.yellow{ border-color: rgba(250,204,21,.55); }
    .stat-pill.gray  { border-color: rgba(148,163,184,.6); }

    .toolbar-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 8px;
      flex-wrap: wrap;
    }
    .login-pill {
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15,23,42,.9);
      border: 1px solid rgba(148,163,184,.35);
      font-size: 12px;
    }
    .login-pill span {
      color: #9ca3af;
    }
    .login-pill strong {
      color: #e5efff;
    }
    .search-box {
      flex: 1;
      min-width: 220px;
      position: relative;
    }
    .search-input {
      width: 100%;
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,.45);
      background: rgba(15,23,42,.95);
      color: #e5efff;
      font-size: 13px;
      outline: none;
    }
    .search-input::placeholder {
      color: #6b7280;
    }
    .tag-tabs {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .tag-tab {
      font-size: 12px;
      padding: 4px 12px;
      border-radius: 999px;
      border: 1px solid transparent;
      background: rgba(15,23,42,.92);
      color: #9ca3af;
      cursor: pointer;
      user-select: none;
    }
    .tag-tab.active {
      background: linear-gradient(135deg,#22d3ee,#4f46e5);
      color: #e5f2ff;
      border-color: transparent;
      box-shadow: 0 0 0 1px rgba(59,130,246,.4), 0 10px 25px rgba(15,23,42,.75);
    }

    /* çŠ¶æ€ç­›é€‰æ¡ */
    .status-filter-bar {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-top: 10px;
      font-size: 11px;
    }
    .status-chip {
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,.4);
      background: rgba(15,23,42,.95);
      color: #9ca3af;
      cursor: pointer;
      user-select: none;
    }
    .status-chip.active {
      color: #e5f2ff;
      border-color: rgba(129,140,248,.9);
      background: radial-gradient(circle at top,#22c55e33,#0f172a);
    }

    /* å¡ç‰‡æ …æ ¼ */
    .card-grid {
      margin-top: 18px;
      display: grid;
      grid-template-columns: repeat(auto-fill,minmax(260px,1fr));
      gap: 14px;
    }
    .card {
      border-radius: 16px;
      background: radial-gradient(circle at top left,rgba(56,189,248,.05),rgba(15,23,42,.98));
      border: 1px solid rgba(148,163,184,.3);
      padding: 12px 14px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      box-shadow: 0 16px 30px rgba(15,23,42,.8);
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 6px;
    }
    .card-title {
      font-size: 14px;
      font-weight: 600;
      color: #e5edff;
    }
    .card-sub {
      font-size: 11px;
      color: #9ca3af;
    }
    .pill-status {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,.35);
      background: rgba(15,23,42,.95);
      color: #9ca3af;
      white-space: nowrap;
    }
    .pill-status.ok      { border-color: rgba(52,211,153,.7); color: #bbf7d0; }
    .pill-status.pending { border-color: rgba(250,204,21,.7); color: #facc15; }
    .pill-status.none    { border-color: rgba(148,163,184,.6); }
    .pill-status.gray    { border-color: rgba(148,163,184,.6); }

    .card-body {
      font-size: 12px;
      color: #d1d5db;
      line-height: 1.5;
    }
    .activity-title {
      margin-bottom: 4px;
    }
    .activity-title a {
      color: #93c5fd;
      text-decoration: none;
    }
    .activity-title a:hover {
      text-decoration: underline;
    }
    .time-row {
      font-size: 11px;
      color: #9ca3af;
    }
    .time-row span {
      opacity: .95;
    }

    .footer-hint {
      margin-top: 20px;
      font-size: 11px;
      color: #6b7280;
    }
    .footer-hint code {
      padding: 1px 4px;
      border-radius: 4px;
      background: rgba(15,23,42,.95);
      border: 1px solid rgba(55,65,81,.8);
      color: #9ca3af;
    }

    .status-dot {
      display: inline-block;
      width: 6px;
      height: 6px;
      border-radius: 999px;
      margin-right: 4px;
      background: #f97316;
      box-shadow: 0 0 0 4px rgba(248,153,60,.35);
    }
  </style>
</head>
<body>
<div class="app-root">
  <header class="app-header">
    <div class="app-title-row">
      <div class="app-title-left">
        <div>
          <div class="logo-text">NTX QUEST RADAR</div>
          <div class="app-title-sub">Galxe ç©ºæŠ•é¡¹ç›®é›†ä¸­ç›‘æ§ Â· Powered by NTX</div>
        </div>
        <div class="logo-badge">OpenAPI Â· V4.1</div>
      </div>
      <div id="online-indicator" class="app-title-sub">
        <span class="status-dot"></span>è¿æ¥ä¸­â€¦
      </div>
    </div>

    <div class="stat-bar">
      <div class="stat-label-main" id="stat-latest">æœ€è¿‘åˆ·æ–°ï¼šâ€”</div>
      <div class="stat-badges" id="stat-badges">
        <span class="stat-pill gray">é¡¹ç›®æ€»æ•°ï¼š<strong>â€”</strong></span>
        <span class="stat-pill green">æœ‰æ´»åŠ¨é¡¹ç›®ï¼š<strong>â€”</strong></span>
        <span class="stat-pill yellow">è¿›è¡Œä¸­ï¼š<strong>â€”</strong></span>
        <span class="stat-pill gray">æœªå¼€å§‹ï¼š<strong>â€”</strong></span>
        <span class="stat-pill gray">å·²ç»“æŸï¼š<strong>â€”</strong></span>
      </div>
    </div>

    <div class="toolbar-row">
      <div class="login-pill">
        <span>ç™»å½•å¯†ç ï¼š</span><strong>admin</strong>
      </div>

      <div class="search-box">
        <input id="searchInput" class="search-input" placeholder="æœç´¢é¡¹ç›®å / alias / æ´»åŠ¨æ ‡é¢˜â€¦" />
      </div>

      <div class="tag-tabs">
        <button class="tag-tab active" data-mode="all">å…¨éƒ¨</button>
        <button class="tag-tab" data-mode="custom">è‡ªå®šä¹‰</button>
        <button class="tag-tab" data-mode="hot">çƒ­åº¦ Top</button>
        <button class="tag-tab" data-mode="manage" onclick="goManage()">é¡¹ç›®ç®¡ç†</button>
      </div>
    </div>

    <div class="status-filter-bar">
      <div class="status-chip active" data-filter="all">å…¨éƒ¨çŠ¶æ€</div>
      <div class="status-chip" data-filter="running">è¿›è¡Œä¸­</div>
      <div class="status-chip" data-filter="upcoming">æœªå¼€å§‹</div>
      <div class="status-chip" data-filter="ended">å·²ç»“æŸ</div>
      <div class="status-chip" data-filter="none">æš‚æ— æ´»åŠ¨</div>
    </div>
  </header>

  <main>
    <div id="cardGrid" class="card-grid"></div>
    <div class="footer-hint">
      æç¤ºï¼šæ•°æ®æ¥è‡ªåç«¯æ¥å£ <code>/api/raw?pwd=admin</code>ã€‚å¦‚éœ€æ”¹å¯†ç ï¼Œè¯·åŒæ­¥ä¿®æ”¹ <code>config.json</code> ä¸­ <code>webui_password</code> ä¸æœ¬é¡µè„šæœ¬é‡Œçš„ PWDã€‚
    </div>
  </main>
</div>

<script>
  const PWD = "admin";
  const API_URL = "/?raw=1&pwd=" + encodeURIComponent(PWD);

  const state = {
    projects: [],
    mode: "all",
    search: "",
    statusFilter: "all",
  };

  function goManage() {
    const url = location.origin + "/manage?pwd=" + encodeURIComponent(PWD);
    window.open(url, "_blank");
  }

  function normalizeStatus(p) {
    if (!p.latest || !p.latest.status) return "none";
    const s = (p.latest.status || "").toLowerCase();
    if (s.includes("è¿›è¡Œ") || s.includes("running")) return "running";
    if (s.includes("æœªå¼€å§‹") || s.includes("upcoming")) return "upcoming";
    if (s.includes("å·²ç»“æŸ") || s.includes("ended")) return "ended";
    return "none";
  }

  function applyFilter(list) {
    let res = list;
    if (state.search.trim()) {
      const q = state.search.trim().toLowerCase();
      res = res.filter(p => {
        const title = (p.name || "").toLowerCase();
        const alias = (p.alias || "").toLowerCase();
        const act  = (p.latest && p.latest.title || "").toLowerCase();
        return title.includes(q) || alias.includes(q) || act.includes(q);
      });
    }
    if (state.statusFilter !== "all") {
      res = res.filter(p => normalizeStatus(p) === state.statusFilter);
    }
    return res;
  }

  function render(data) {
    const latestEl = document.getElementById("stat-latest");
    const badgesEl = document.getElementById("stat-badges");
    const grid     = document.getElementById("cardGrid");

    const projects = data.projects || [];
    state.projects = projects;

    // ç»Ÿè®¡ä¿¡æ¯
    const total = projects.length;
    const hasActivity = projects.filter(p => p.latest && p.latest.title).length;
    const running = projects.filter(p => normalizeStatus(p) === "running").length;
    const upcoming = projects.filter(p => normalizeStatus(p) === "upcoming").length;
    const ended = projects.filter(p => normalizeStatus(p) === "ended").length;

    latestEl.textContent = "æœ€è¿‘åˆ·æ–°ï¼š" + (data.last_refresh || "æœªçŸ¥");

    badgesEl.innerHTML = `
      <span class="stat-pill gray">é¡¹ç›®æ€»æ•°ï¼š<strong>${total}</strong></span>
      <span class="stat-pill green">æœ‰æ´»åŠ¨é¡¹ç›®ï¼š<strong>${hasActivity}</strong></span>
      <span class="stat-pill yellow">è¿›è¡Œä¸­ï¼š<strong>${running}</strong></span>
      <span class="stat-pill gray">æœªå¼€å§‹ï¼š<strong>${upcoming}</strong></span>
      <span class="stat-pill gray">å·²ç»“æŸï¼š<strong>${ended}</strong></span>
    `;

    const filtered = applyFilter(projects);

    grid.innerHTML = filtered.map(p => {
      const l = p.latest || {};
      const statusNorm = normalizeStatus(p);
      let statusText = l.status || "æš‚æ— æ´»åŠ¨";
      let statusClass = "gray";
      if (statusNorm === "running") { statusClass = "ok"; }
      else if (statusNorm === "upcoming") { statusClass = "pending"; }
      else if (statusNorm === "ended") { statusClass = "none"; }

      const actLink = l.url ? `<a href="${l.url}" target="_blank" rel="noopener noreferrer">${l.title || "ç‚¹å‡»æŸ¥çœ‹æ´»åŠ¨è¯¦æƒ…"}</a>` : (l.title || "å½“å‰æ²¡æœ‰å¯è§æ´»åŠ¨æˆ–æ‹‰å–å¤±è´¥ã€‚");

      return `
        <div class="card" data-status="${statusNorm}">
          <div class="card-header">
            <div>
              <div class="card-title">${p.name || "-"}</div>
              <div class="card-sub">@${p.alias || "-"} Â· ğŸ”¥ Trending</div>
            </div>
            <div class="pill-status ${statusClass}">${statusText}</div>
          </div>
          <div class="card-body">
            <div class="activity-title">æœ€æ–°æ´»åŠ¨ï¼š${actLink}</div>
            <div class="time-row">
              <div>å¼€å§‹æ—¶é—´ï¼š<span>${l.start_time || "-"}</span></div>
              <div>ç»“æŸæ—¶é—´ï¼š<span>${l.end_time || "-"}</span></div>
            </div>
          </div>
        </div>
      `;
    }).join("");
  }

  async function fetchData() {
    const indicator = document.getElementById("online-indicator");
    try {
      indicator.innerHTML = '<span class="status-dot" style="background:#22c55e;box-shadow:0 0 0 4px rgba(34,197,94,.35)"></span>å·²è¿æ¥';
      const resp = await fetch(API_URL, { cache: "no-store" });
      if (!resp.ok) throw new Error("HTTP " + resp.status);
      const data = await resp.json();
      render(data);
    } catch (err) {
      indicator.innerHTML = '<span class="status-dot" style="background:#ef4444;box-shadow:0 0 0 4px rgba(248,113,113,.35)"></span>è¿æ¥å¼‚å¸¸';
      console.error(err);
    }
  }

  document.getElementById("searchInput").addEventListener("input", e => {
    state.search = e.target.value || "";
    render({ ...{ last_refresh: "", projects: state.projects } , projects: state.projects });
  });

  document.querySelectorAll(".status-chip").forEach(chip => {
    chip.addEventListener("click", () => {
      document.querySelectorAll(".status-chip").forEach(c => c.classList.remove("active"));
      chip.classList.add("active");
      state.statusFilter = chip.getAttribute("data-filter") || "all";
      render({ ...{ last_refresh: "", projects: state.projects } , projects: state.projects });
    });
  });

  document.querySelectorAll(".tag-tab").forEach(tab => {
    tab.addEventListener("click", () => {
      if (tab.dataset.mode === "manage") return;
      document.querySelectorAll(".tag-tab").forEach(t => t.classList.remove("active"));
      tab.classList.add("active");
      state.mode = tab.dataset.mode || "all";
      // ç›®å‰ mode åªæ˜¯å ä½ï¼Œåé¢å¦‚æœè¦åšè‡ªå®šä¹‰åˆ—è¡¨å†ç”¨
    });
  });

  fetchData();
  setInterval(fetchData, 60000);
</script>
</body>
</html>
