# 代码版本管理说明

## 📦 当前稳定版本信息

**最新稳定版本**: 2025-11-19 01:10 (commit: 233949e)

**功能清单**:
- ✅ 多Bot多群组推送
- ✅ Web界面管理推送目标
- ✅ 项目过滤规则
- ✅ Galxe空投任务监控
- ✅ NTX社区品牌标识

---

## 🔄 如何回滚到任意版本

### 方法1: 查看历史版本

```bash
# 进入项目目录
cd "/Users/xingxiu/Desktop/Glaxe 项目抓取备份/GalxeMonitor"

# 查看所有提交记录
git log --oneline

# 你会看到类似:
# 233949e 🎨 style: 简化消息格式品牌标识
# 8d697dd ✨ feat: Web界面添加多Bot多群组管理功能
# 512f46c 📚 docs: 添加快速使用指南
# 8a54bba ✨ feat: 支持多Bot多群组通知功能
```

### 方法2: 回滚到指定版本

```bash
# 回滚到某个版本(例如 8d697dd)
git checkout 8d697dd

# 或者创建一个新分支保存当前版本
git checkout -b backup-20251119
```

### 方法3: 恢复到最新版本

```bash
# 回到最新版本
git checkout main

# 从远程拉取最新代码
git pull origin main
```

---

## 💾 一键备份脚本

**快速备份当前完整代码**:

```bash
#!/bin/bash
# 备份脚本 - backup.sh

BACKUP_DIR="$HOME/Desktop/GalxeMonitor_Backups"
TIMESTAMP=$(date +"%Y%m%d_%H%M%S")
BACKUP_NAME="GalxeMonitor_${TIMESTAMP}"

# 创建备份目录
mkdir -p "$BACKUP_DIR"

# 压缩备份
cd "/Users/xingxiu/Desktop/Glaxe 项目抓取备份"
tar -czf "$BACKUP_DIR/${BACKUP_NAME}.tar.gz" \
    --exclude='GalxeMonitor/__pycache__' \
    --exclude='GalxeMonitor/logs' \
    --exclude='GalxeMonitor/.git' \
    GalxeMonitor/

echo "✅ 备份完成: $BACKUP_DIR/${BACKUP_NAME}.tar.gz"
```

**使用方法**:

```bash
chmod +x backup.sh
./backup.sh
```

---

## 🔐 GitHub完整恢复指南

### 从GitHub完全恢复项目

如果本地代码完全丢失,可以从GitHub重新克隆:

```bash
# 1. 克隆仓库
cd ~/Desktop
git clone git@github.com:yueyeye888-blip/Glaxe-.git GalxeMonitor_Restored

# 2. 进入目录
cd GalxeMonitor_Restored

# 3. 查看所有版本
git log --oneline

# 4. 切换到稳定版本(例如当前最新)
git checkout 233949e
```

### 恢复配置文件

**重要**: `config.json` 包含敏感信息(Bot Token),已在 `.gitignore` 中排除。

**恢复步骤**:

1. **从备份恢复配置**:
```bash
# 如果有备份的配置文件
cp ~/备份位置/config.json config_files/config.json
```

2. **或者重新配置**:
```bash
# 使用配置示例
cp config_files/config.multi_targets_example.json config_files/config.json

# 编辑配置文件
nano config_files/config.json
```

3. **运行迁移工具**:
```bash
python3 migrate_config.py
```

---

## 📋 完整恢复检查清单

### 步骤1: 克隆代码
- [ ] 从GitHub克隆仓库
- [ ] 切换到稳定版本 (233949e)

### 步骤2: 安装依赖
```bash
pip3 install -r requirements.txt
```

### 步骤3: 恢复配置
- [ ] 复制或重建 `config_files/config.json`
- [ ] 配置Bot Token和Chat ID
- [ ] 添加监控项目列表

### 步骤4: 测试运行
```bash
# 测试Telegram通知
python3 test_notification.py

# 启动服务
python3 src/app.py
```

### 步骤5: 访问Web界面
```
http://服务器IP:5001/?pwd=admin
```

---

## 🚨 紧急恢复命令

**一键恢复到当前稳定版本**:

```bash
#!/bin/bash
# emergency_restore.sh

cd "/Users/xingxiu/Desktop/Glaxe 项目抓取备份/GalxeMonitor"

# 停止服务
lsof -ti:5001 | xargs kill -9 2>/dev/null

# 丢弃所有本地修改
git reset --hard HEAD

# 拉取最新代码
git pull origin main

# 重启服务
nohup python3 src/app.py > /dev/null 2>&1 &

echo "✅ 已恢复到最新稳定版本"
```

---

## 📝 重要文件列表

**必须备份的文件**:
1. `config_files/config.json` - 配置文件(包含Bot Token)
2. `data/monitor_state.json` - 监控状态
3. `.gitignore` - Git忽略规则

**代码文件**:
- 所有代码文件已在GitHub,可随时恢复
- 提交ID: `233949e` (当前最新稳定版本)

---

## 🔧 常见问题

### Q: 代码改崩了怎么办?

**A**: 立即回滚:
```bash
cd "/Users/xingxiu/Desktop/Glaxe 项目抓取备份/GalxeMonitor"
git reset --hard HEAD
```

### Q: 配置文件丢失怎么办?

**A**: 
1. 从备份恢复
2. 或者参考 `config.multi_targets_example.json` 重建

### Q: 如何验证代码完整性?

**A**: 
```bash
# 查看当前版本
git log -1

# 应该显示:
# commit 233949e...
# 🎨 style: 简化消息格式品牌标识
```

### Q: GitHub能100%恢复吗?

**A**: 
- ✅ 所有代码: 100%可恢复
- ⚠️ 配置文件: 需要单独备份(包含敏感信息,未提交到Git)
- ✅ 依赖包: 通过 `requirements.txt` 可重装

---

## 📞 技术支持

如果恢复过程遇到问题:

1. 查看日志: `tail -f logs/app.log`
2. 检查进程: `ps aux | grep python3`
3. 检查端口: `lsof -ti:5001`

---

## 🎯 最佳实践建议

### 每次修改前:
1. 创建备份: `./backup.sh`
2. 或创建Git分支: `git checkout -b test-feature`

### 修改后:
1. 测试功能: `python3 test_notification.py`
2. 如果正常,提交: `git add -A && git commit -m "描述"`
3. 如果异常,回滚: `git reset --hard HEAD`

### 定期维护:
- 每周备份配置文件
- 每月检查GitHub提交记录
- 保留最近3个版本的完整备份

---

**记住**: 
- Git提交ID `233949e` 是当前最稳定版本
- 所有代码都在GitHub,永不丢失
- 只需备份配置文件即可完全恢复
