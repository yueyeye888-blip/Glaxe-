# 📚 GalxeMonitor 推送队列系统 - 文档导航

## 🎯 开始阅读

**如果你是第一次了解这个系统，按这个顺序阅读：**

1. **📦_交付说明.md** ← 从这里开始！
   - 了解项目交付确认
   - 查看最终验证结果
   - 确认所有功能就绪

2. **🚀_推送队列系统_实施完成.md**
   - 完整的系统说明
   - 工作原理详解
   - 代码改动说明

3. **快速参考卡.md**
   - 常用命令快速查询
   - 文件位置索引
   - FAQ问答

---

## 📂 本地文档结构

```
/Users/xingxiu/
│
├─ 📦_交付说明.md                    ⭐ 项目交付说明（从这里开始）
├─ 🚀_推送队列系统_实施完成.md       ⭐ 完整系统说明
├─ 系统实施完成总结.md              ⭐ 实施总结和故障排查
├─ 快速参考卡.md                    ⭐ 常用命令参考
│
├─ monitor_queue.py                 🔧 监控脚本（实用工具）
│
├─ 修改方案详解.md                  📋 代码修改细节
├─ 推送机制详解.md                  📋 推送机制分析
└─ README.md                        📖 本文件
```

---

## 🔍 按需查阅

### 📌 "我想快速了解系统"
→ 阅读 **📦_交付说明.md** 的前两部分

### ⚡ "我想快速查命令"
→ 查看 **快速参考卡.md** 的"⚡快速命令"部分

### 🔧 "系统出问题了"
→ 查看 **系统实施完成总结.md** 的"故障排查指南"

### 📊 "我想监控系统状态"
→ 运行 `python3 monitor_queue.py quick` 或 `monitor_queue.py`

### 💻 "我想理解代码改动"
→ 阅读 **修改方案详解.md** 或 **系统实施完成总结.md** 的代码部分

---

## 🚀 最常用的操作

### 检查系统是否正常
```bash
python3 /Users/xingxiu/monitor_queue.py quick
```
**预期结果**: 所有项都显示 ✅

### 实时监控队列
```bash
python3 /Users/xingxiu/monitor_queue.py
```
**说明**: 每60秒更新一次，显示队列大小和进程状态

### 查看服务器上的日志
```bash
ssh root@47.76.90.4 'tail -50 /root/GalxeMonitor/logs/app.log | grep -E "推送|队列|启动"'
```

### 查看队列内容
```bash
ssh root@47.76.90.4 'head -50 /root/GalxeMonitor/data/push_queue.json'
```

---

## 📊 系统运行情况

### 验证清单 (所有项都 ✅)
- [x] 进程运行中 (PID: 66552)
- [x] 队列文件存在
- [x] 日志文件生成
- [x] 队列处理器启动
- [x] 所有函数集成
- [x] Telegram配置有效

### 性能指标
- CPU 占用: ~1% (低)
- 内存占用: ~38 MB (正常)
- 推送延迟: 最多 30 分钟 (设计特性)
- 单次通知: 保证 (避免重复)

---

## 🎯 系统功能一览

| 功能 | 说明 | 状态 |
|------|------|------|
| 自动检测 | 每30秒扫描372个项目的新活动 | ✅ |
| 队列管理 | 自动添加到推送队列，避免重复 | ✅ |
| 计时推送 | 每30分钟推送一个项目到TG | ✅ |
| 单次通知 | 同一活动只推送一次 | ✅ |
| 持久化 | 重启后队列自动恢复 | ✅ |
| 线程安全 | 使用互斥锁保护队列访问 | ✅ |
| 完整日志 | 所有操作都有日志记录 | ✅ |

---

## 💡 关键概念

### 推送间隔: 30分钟
系统不会立即推送检测到的新项目，而是加入队列，每30分钟从队列中取出一个项目并推送。

### 去重机制
使用 (space_id, activity_id) 组合确保每个活动只在队列中出现一次，避免重复推送。

### 队列持久化
队列数据保存到 `/root/GalxeMonitor/data/push_queue.json` 文件，即使服务重启也不会丢失。

### 线程模型
- **monitor_loop**: 主监控线程，持续扫描项目 (daemon=False)
- **process_push_queue**: 队列处理线程，定时推送 (daemon=True)

---

## 📞 快速问题解答

**Q: 系统什么时候推送？**  
A: 每30分钟推送一个项目。首次推送可能需要等待最多30分钟。

**Q: 队列在哪里？**  
A: `/root/GalxeMonitor/data/push_queue.json`

**Q: 如何查看队列大小？**  
A: 
```bash
ssh root@47.76.90.4 'wc -l /root/GalxeMonitor/data/push_queue.json'
```

**Q: 如何重启系统？**  
A:
```bash
ssh root@47.76.90.4 'pkill -f "python3 src/app.py"; sleep 2; cd /root/GalxeMonitor && nohup python3 src/app.py > logs/app.log 2>&1 &'
```

**Q: 如何清空队列？**  
A:
```bash
ssh root@47.76.90.4 'rm /root/GalxeMonitor/data/push_queue.json'
# 然后重启系统
```

**Q: 系统不推送怎么办？**  
A: 查看 **系统实施完成总结.md** 的故障排查指南

---

## 📋 文档清单

| 文件 | 用途 | 阅读时间 |
|-----|------|---------|
| 📦_交付说明.md | **项目交付说明** | 5 分钟 ⭐ |
| 🚀_推送队列系统_实施完成.md | **完整系统文档** | 15 分钟 ⭐ |
| 系统实施完成总结.md | **实施总结 + 故障排查** | 20 分钟 |
| 快速参考卡.md | **命令速查表** | 5 分钟 |
| 修改方案详解.md | 代码改动细节 | 15 分钟 |
| 推送机制详解.md | 推送机制分析 | 10 分钟 |

---

## ✨ 工作流概览

```
新项目活动被检测
    ↓
add_to_push_queue() 添加到队列
    ↓
保存队列到 JSON 文件
    ↓
等待 30 分钟...
    ↓
process_push_queue() 处理队列
    ↓
send_notifications() 发送 TG 通知
    ↓
完成！ ✅
```

---

## 🔗 重要链接

**服务器信息**
- IP: 47.76.90.4
- User: root
- SSH: `ssh root@47.76.90.4`

**应用位置**
- 主程序: `/root/GalxeMonitor/src/app.py`
- 配置: `/root/GalxeMonitor/config_files/config.json`
- 队列: `/root/GalxeMonitor/data/push_queue.json`
- 日志: `/root/GalxeMonitor/logs/app.log`
- Web UI: `http://47.76.90.4:5001`

**本地工具**
- 监控脚本: `/Users/xingxiu/monitor_queue.py`
- 文档目录: `/Users/xingxiu/`

---

## 🎓 学习路径

### 入门级 (5分钟)
1. 阅读 📦_交付说明.md 前两部分
2. 运行 `python3 monitor_queue.py quick`
3. 理解系统已就绪

### 初级 (20分钟)
1. 完整阅读 📦_交付说明.md
2. 快速浏览 🚀_推送队列系统_实施完成.md
3. 收藏 快速参考卡.md

### 中级 (45分钟)
1. 详细阅读 🚀_推送队列系统_实施完成.md
2. 理解代码改动（修改方案详解.md）
3. 学习故障排查指南

### 高级 (2小时)
1. 深入阅读所有文档
2. 查阅服务器上的源代码
3. 理解多线程架构
4. 能够扩展或修改系统

---

## 🆘 遇到问题？

1. **查看本地日志**
   ```bash
   ssh root@47.76.90.4 'tail -100 /root/GalxeMonitor/logs/app.log'
   ```

2. **运行系统检查**
   ```bash
   python3 /Users/xingxiu/monitor_queue.py quick
   ```

3. **查阅故障排查指南**
   → 系统实施完成总结.md → 故障排查指南

4. **查阅快速参考卡**
   → 快速参考卡.md → 🔧 高级操作

---

## 📝 最后提醒

✅ **系统已准备好使用**  
✅ **所有功能验证通过**  
✅ **完整文档已提供**  
✅ **监控工具已就绪**  

**开始使用吧！** 🚀

---

**文档生成时间**: 2025-11-21  
**最后更新**: 2025-11-21 02:15 UTC+8  
**版本**: 1.0 Final Release
